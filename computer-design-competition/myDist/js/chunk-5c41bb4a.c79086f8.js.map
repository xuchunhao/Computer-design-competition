{"version":3,"sources":["webpack:///./src/views/porotrait.vue?a280","webpack:///src/views/porotrait.vue","webpack:///./src/views/porotrait.vue?87f5","webpack:///./src/views/porotrait.vue","webpack:///./src/views/porotrait.vue?c6d1"],"names":["render","_vm","this","_h","$createElement","_c","_self","staticClass","attach","staticStyle","attrs","laterUrl","_e","on","$event","dialogVisible","handleClose","uploadImg","ref","customaryUrl","options","autoCrop","fixedBox","canMoveBox","autoCropWidth","autoCropHeight","centerBox","fixed","realTime","_v","style","previews","url","cut","staticRenderFns","components","VueCropper","id","userId","attachType","fileName","uploadImgRelaPath","methods","data","sessionStorage","getItem","$axios","post","then","res","e","num","file","target","files","test","value","$message","error","reader","FileReader","readAsDataURL","onload","result","type","$refs","cropper","getCropData","component"],"mappings":"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","file":"js/chunk-5c41bb4a.c79086f8.js","sourcesContent":["var render = function () {var _vm=this;var _h=_vm.$createElement;var _c=_vm._self._c||_h;return _c('div',{staticClass:\"footerBtn\"},[(_vm.attach.laterUrl)?_c('img',{staticClass:\"preview\",staticStyle:{\"width\":\"200px\",\"height\":\"200px\"},attrs:{\"src\":_vm.attach.laterUrl}}):_vm._e(),_c('el-button',{staticClass:\"btn-edit\",attrs:{\"icon\":\"el-icon-edit\"},on:{\"click\":function($event){_vm.dialogVisible=true}}}),_c('el-dialog',{attrs:{\"title\":\"编辑头像\",\"visible\":_vm.dialogVisible,\"before-close\":_vm.handleClose},on:{\"update:visible\":function($event){_vm.dialogVisible=$event}}},[_c('span',[_c('el-row',[_c('input',{staticClass:\"el-button\",staticStyle:{\"margin-bottom\":\"15px\"},attrs:{\"type\":\"file\",\"id\":\"uploads\",\"accept\":\"image/png, image/jpeg, image/gif, image/jpg\"},on:{\"change\":function($event){return _vm.uploadImg($event,1)}}})]),_c('el-row',[_c('el-col',{attrs:{\"span\":16}},[_c('vueCropper',{ref:\"cropper\",staticStyle:{\"width\":\"100%\",\"height\":\"300px\"},attrs:{\"img\":_vm.attach.customaryUrl,\"autoCrop\":_vm.options.autoCrop,\"fixedBox\":_vm.options.fixedBox,\"canMoveBox\":_vm.options.canMoveBox,\"autoCropWidth\":_vm.options.autoCropWidth,\"autoCropHeight\":_vm.options.autoCropHeight,\"centerBox\":_vm.options.centerBox,\"fixed\":_vm.options.fixed},on:{\"realTime\":_vm.realTime}})],1),_c('el-col',{attrs:{\"span\":8}},[_c('h2',{attrs:{\"align\":\"center\"}},[_vm._v(\"头像预览\")]),_c('div',{staticClass:\"show-preview\"},[_c('div',{staticClass:\"preview\",style:(_vm.previews.div)},[_c('img',{style:(_vm.previews.img),attrs:{\"src\":_vm.previews.url}})])])])],1),_c('el-row',{staticClass:\"footerBtn\",attrs:{\"align\":\"center\"}},[_c('el-button',{staticClass:\"btn-content\",attrs:{\"type\":\"primary\",\"size\":\"small\",\"round\":\"\"},on:{\"click\":function($event){return _vm.cut('blob')}}},[_vm._v(\"确认\")]),_c('el-button',{staticClass:\"btn-content\",attrs:{\"type\":\"primary\",\"size\":\"small\",\"round\":\"\"},on:{\"click\":_vm.handleClose}},[_vm._v(\"取消\")])],1)],1)])],1)}\nvar staticRenderFns = []\n\nexport { render, staticRenderFns }","<template>\r\n  <div class=\"footerBtn\">\r\n    <img\r\n      v-if=\"attach.laterUrl\"\r\n      :src=\"attach.laterUrl\"\r\n      class=\"preview\"\r\n      style=\"width:200px;height:200px\"\r\n    />\r\n    <el-button class=\"btn-edit\" icon=\"el-icon-edit\" @click=\"dialogVisible=true\"></el-button>\r\n\r\n    <!-- 弹出层-裁剪 -->\r\n    <el-dialog title=\"编辑头像\" :visible.sync=\"dialogVisible\" :before-close=\"handleClose\">\r\n      <span>\r\n        <el-row>\r\n          <input\r\n            type=\"file\"\r\n            id=\"uploads\"\r\n            accept=\"image/png, image/jpeg, image/gif, image/jpg\"\r\n            @change=\"uploadImg($event,1)\"\r\n            class=\"el-button\"\r\n            style=\"margin-bottom:15px\"\r\n          />\r\n        </el-row>\r\n        <el-row>\r\n          <el-col :span=\"16\">\r\n            <!-- 裁剪 -->\r\n            <vueCropper\r\n              style=\"width:100%;height:300px\"\r\n              ref=\"cropper\"\r\n              :img=\"attach.customaryUrl\"\r\n              :autoCrop=\"options.autoCrop\"\r\n              :fixedBox=\"options.fixedBox\"\r\n              :canMoveBox=\"options.canMoveBox\"\r\n              :autoCropWidth=\"options.autoCropWidth\"\r\n              :autoCropHeight=\"options.autoCropHeight\"\r\n              :centerBox=\"options.centerBox\"\r\n              :fixed=\"options.fixed\"\r\n              @realTime=\"realTime\"\r\n            ></vueCropper>\r\n          </el-col>\r\n          <el-col :span=\"8\">\r\n            <h2 align=\"center\">头像预览</h2>\r\n            <div class=\"show-preview\">\r\n              <div :style=\"previews.div\" class=\"preview\">\r\n                <img :src=\"previews.url\" :style=\"previews.img\" />\r\n              </div>\r\n            </div>\r\n          </el-col>\r\n        </el-row>\r\n        <el-row class=\"footerBtn\" align=\"center\">\r\n          <el-button class=\"btn-content\" type=\"primary\" size=\"small\" round @click=\"cut('blob')\">确认</el-button>\r\n          <el-button class=\"btn-content\" type=\"primary\" size=\"small\" round @click=\"handleClose\">取消</el-button>\r\n        </el-row>\r\n      </span>\r\n    </el-dialog>\r\n  </div>\r\n</template>\r\n\r\n<script>\r\n//数据库里需要存两份图片地址，一张为原图地址，一张为裁剪后的头像地址\r\nimport { VueCropper }  from 'vue-cropper' \r\n// import api from \"@/api/index.js\";\r\n\r\nexport default {\r\n  components: {\r\n      VueCropper,\r\n    },\r\n  data() {\r\n    return {\r\n      dialogVisible: false,\r\n      options: {\r\n        autoCrop: true, //默认生成截图框\r\n        fixedBox: false, //固定截图框大小\r\n        canMoveBox: true, //截图框不能拖动\r\n        autoCropWidth: 200, //截图框宽度\r\n        autoCropHeight: 200, //截图框高度\r\n        centerBox: false, //截图框被限制在图片里面\r\n        fixed:true\r\n      },\r\n      previews: {}, //实时预览图数据\r\n      attach: {\r\n        //后端附件表\r\n        id: \"\",\r\n        userId: \"\",\r\n        customaryUrl: \"\", //原图片路径\r\n        laterUrl: \"\", //裁剪后图片路径  /static/logo.png\r\n        attachType: \"photo\" //附件类型\r\n      },\r\n      fileName: \"\", //本机文件地址\r\n      uploadImgRelaPath: \"\" //上传后图片地址\r\n    };\r\n  },\r\n  methods: {\r\n    //控制弹出层关闭\r\n    handleClose() {\r\n      this.dialogVisible = false;\r\n    },\r\n    //实时预览\r\n    realTime(data) {\r\n      this.previews = data;\r\n    },\r\n    //加载头像信息\r\n    find() {\r\n      this.userId = sessionStorage.getItem(\"userId\");\r\n      this.$axios.post(\"/api/attach/find\", this.attach).then(res => {\r\n        // console.log(res);\r\n      });\r\n    },\r\n    //选择本地图片\r\n    uploadImg(e, num) {\r\n      var file = e.target.files[0];\r\n      if (!/\\.(gif|jpg|jpeg|png|bmp|GIF|JPG|PNG)$/.test(e.target.value)) {\r\n        this.$message.error(\"图片类型必须是.gif,jpeg,jpg,png,bmp中的一种\");\r\n        return false;\r\n      }\r\n      // console.log(e.target.result);\r\n      //fileReader 接口，用于异步读取文件数据\r\n      var reader = new FileReader();\r\n      reader.readAsDataURL(file); //重要 以dataURL形式读取文件\r\n      reader.onload = e => {\r\n        // data = window.URL.createObjectURL(new Blob([e.target.result])) 转化为blob格式\r\n\r\n        let data = e.target.result;\r\n\r\n        this.attach.customaryUrl = data;\r\n        // 转化为base64\r\n        // reader.readAsDataURL(file)\r\n        // 转化为blob\r\n      };\r\n    },\r\n    //确认截图,上传\r\n    cut(type) {\r\n      this.$refs.cropper.getCropData(res => {\r\n        //res是裁剪后图片的bolb对象\r\n        // api.changePortrait({\r\n        //     \"id\":1234,\r\n        //     \"type\":\"portrait\",\r\n        //     \"subtype\":\"upload\",\r\n        //     \"data\":{\r\n        //       \"base64\":res\r\n        //       }\r\n        //     }).then(res => {\r\n        //       // console.log(res)\r\n        //       this.$router.go(0)\r\n        //     })\r\n      });\r\n    }\r\n  }\r\n};\r\n</script>\r\n\r\n<style lang=\"less\" scoped>\r\n/* 弹性布局 水平居中 */\r\n.show-preview {\r\n  display: flex;\r\n  justify-content: center;\r\n}\r\n\r\n.preview {\r\n  border-radius: 50%;\r\n  overflow: hidden;\r\n  border: 1px solid #cccccc;\r\n  background: #cccccc;\r\n}\r\n.footerBtn {\r\n  display: flex;\r\n  justify-content: center;\r\n  margin-top: 15px;\r\n  .btn-edit{\r\n    border-radius: 50%;\r\n    width: 50px;\r\n    height: 50px;\r\n    position: absolute;\r\n    left: 270px;\r\n    top: 220px;\r\n    font-size: 20px;\r\n    border: none;\r\n    background: #fff;\r\n  }\r\n  .btn-content{\r\n    background-color: rgb(165, 42, 26);\r\n    border: none;\r\n  }\r\n}\r\n</style>\r\n","import mod from \"-!../../node_modules/cache-loader/dist/cjs.js??ref--0-0!../../node_modules/vue-loader/lib/index.js??vue-loader-options!./porotrait.vue?vue&type=script&lang=js&\"; export default mod; export * from \"-!../../node_modules/cache-loader/dist/cjs.js??ref--0-0!../../node_modules/vue-loader/lib/index.js??vue-loader-options!./porotrait.vue?vue&type=script&lang=js&\"","import { render, staticRenderFns } from \"./porotrait.vue?vue&type=template&id=f7cbea52&scoped=true&\"\nimport script from \"./porotrait.vue?vue&type=script&lang=js&\"\nexport * from \"./porotrait.vue?vue&type=script&lang=js&\"\nimport style0 from \"./porotrait.vue?vue&type=style&index=0&id=f7cbea52&lang=less&scoped=true&\"\n\n\n/* normalize component */\nimport normalizer from \"!../../node_modules/vue-loader/lib/runtime/componentNormalizer.js\"\nvar component = normalizer(\n  script,\n  render,\n  staticRenderFns,\n  false,\n  null,\n  \"f7cbea52\",\n  null\n  \n)\n\nexport default component.exports","import mod from \"-!../../node_modules/mini-css-extract-plugin/dist/loader.js??ref--10-oneOf-1-0!../../node_modules/css-loader/dist/cjs.js??ref--10-oneOf-1-1!../../node_modules/vue-loader/lib/loaders/stylePostLoader.js!../../node_modules/postcss-loader/src/index.js??ref--10-oneOf-1-2!../../node_modules/less-loader/dist/cjs.js??ref--10-oneOf-1-3!../../node_modules/cache-loader/dist/cjs.js??ref--0-0!../../node_modules/vue-loader/lib/index.js??vue-loader-options!./porotrait.vue?vue&type=style&index=0&id=f7cbea52&lang=less&scoped=true&\"; export default mod; export * from \"-!../../node_modules/mini-css-extract-plugin/dist/loader.js??ref--10-oneOf-1-0!../../node_modules/css-loader/dist/cjs.js??ref--10-oneOf-1-1!../../node_modules/vue-loader/lib/loaders/stylePostLoader.js!../../node_modules/postcss-loader/src/index.js??ref--10-oneOf-1-2!../../node_modules/less-loader/dist/cjs.js??ref--10-oneOf-1-3!../../node_modules/cache-loader/dist/cjs.js??ref--0-0!../../node_modules/vue-loader/lib/index.js??vue-loader-options!./porotrait.vue?vue&type=style&index=0&id=f7cbea52&lang=less&scoped=true&\""],"sourceRoot":""}